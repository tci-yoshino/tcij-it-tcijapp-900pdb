<?xml version="1.0"?><DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts" DTS:ExecutableType="MSDTS.Package.1"><DTS:Property DTS:Name="PackageFormatVersion">2</DTS:Property><DTS:Property DTS:Name="VersionComments"></DTS:Property><DTS:Property DTS:Name="CreatorName">akutsu</DTS:Property><DTS:Property DTS:Name="CreatorComputerName">HS-SYS0204</DTS:Property><DTS:Property DTS:Name="CreationDate" DTS:DataType="7">7/3/2008 11:57:21 AM</DTS:Property><DTS:Property DTS:Name="PackageType">5</DTS:Property><DTS:Property DTS:Name="ProtectionLevel">0</DTS:Property><DTS:Property DTS:Name="MaxConcurrentExecutables">-1</DTS:Property><DTS:Property DTS:Name="PackagePriorityClass">0</DTS:Property><DTS:Property DTS:Name="VersionMajor">1</DTS:Property><DTS:Property DTS:Name="VersionMinor">0</DTS:Property><DTS:Property DTS:Name="VersionBuild">333</DTS:Property><DTS:Property DTS:Name="VersionGUID">{4BED4690-E5AC-47E6-BC0E-4CF92D738B09}</DTS:Property><DTS:Property DTS:Name="EnableConfig">-1</DTS:Property><DTS:Property DTS:Name="CheckpointFileName"></DTS:Property><DTS:Property DTS:Name="SaveCheckpoints">0</DTS:Property><DTS:Property DTS:Name="CheckpointUsage">0</DTS:Property><DTS:Property DTS:Name="SuppressConfigurationWarnings">0</DTS:Property>
<DTS:ConnectionManager><DTS:Property DTS:Name="DelayValidation">0</DTS:Property><DTS:Property DTS:Name="ObjectName">ADO.Purchase</DTS:Property><DTS:Property DTS:Name="DTSID">{69167A28-F72C-473C-954D-6D792A9A6420}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName">ADO.NET:System.Data.SqlClient.SqlConnection, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</DTS:Property><DTS:ObjectData><DTS:ConnectionManager><DTS:Password DTS:Name="Password" Sensitive="1"></DTS:Password><DTS:Property DTS:Name="ConnectionString">Data Source=TCIJ-08049;User ID=Purchase;Initial Catalog=AKUTSU_TEST;Persist Security Info=True;</DTS:Property></DTS:ConnectionManager></DTS:ObjectData></DTS:ConnectionManager>
<DTS:ConnectionManager><DTS:Property DTS:Name="DelayValidation">0</DTS:Property><DTS:Property DTS:Name="ObjectName">SMTP</DTS:Property><DTS:Property DTS:Name="DTSID">{0558022D-9833-4694-B076-1EBC3ECE55AD}</DTS:Property><DTS:Property DTS:Name="Description">PurchaseDB ProductImport.dtsx エラーメール送信</DTS:Property><DTS:Property DTS:Name="CreationName">SMTP</DTS:Property><DTS:ObjectData><SmtpConnectionManager ConnectionString="SmtpServer=tex1.tci.tokyokasei;UseWindowsAuthentication=True;EnableSsl=False;"/></DTS:ObjectData></DTS:ConnectionManager>
<DTS:Configuration><DTS:Property DTS:Name="ConfigurationType">1</DTS:Property><DTS:Property DTS:Name="ConfigurationString">C:\tcijapp\Purchase\Batch\Purchase\ProductImport.dtsConfig</DTS:Property><DTS:Property DTS:Name="ConfigurationVariable"></DTS:Property><DTS:Property DTS:Name="ObjectName">構成 1</DTS:Property><DTS:Property DTS:Name="DTSID">{BC434C53-6F5C-47E7-BF1B-945FA1EF307F}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Configuration>
<DTS:PackageVariable><DTS:Property DTS:Name="PackageVariableValue" DTS:DataType="8">&lt;Package xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dwd="http://schemas.microsoft.com/DataWarehouse/Designer/1.0"&gt;&lt;dwd:DtsControlFlowDiagram&gt;&lt;dwd:BoundingLeft&gt;-3133&lt;/dwd:BoundingLeft&gt;&lt;dwd:BoundingTop&gt;-2679&lt;/dwd:BoundingTop&gt;&lt;dwd:Layout&gt;&lt;dds&gt;
  &lt;diagram fontclsid="{0BE35203-8F91-11CE-9DE3-00AA004BB851}" mouseiconclsid="{0BE35204-8F91-11CE-9DE3-00AA004BB851}" defaultlayout="Microsoft.DataWarehouse.Layout.GraphLayout" defaultlineroute="Microsoft.DataWarehouse.Layout.GraphLayout" version="7" nextobject="33" scale="100" pagebreakanchorx="0" pagebreakanchory="0" pagebreaksizex="0" pagebreaksizey="0" scrollleft="-4133" scrolltop="-3175" gridx="150" gridy="150" marginx="1000" marginy="1000" zoom="100" x="16775" y="10927" backcolor="15334399" defaultpersistence="2" PrintPageNumbersMode="3" PrintMarginTop="0" PrintMarginBottom="635" PrintMarginLeft="0" PrintMarginRight="0" marqueeselectionmode="1" mousepointer="0" snaptogrid="0" autotypeannotation="1" showscrollbars="0" viewpagebreaks="0" donotforceconnectorsbehindshapes="1" backpictureclsid="{00000000-0000-0000-0000-000000000000}"&gt;
    &lt;font&gt;
      &lt;ddsxmlobjectstreamwrapper binary="010100009001905f01000c4d5320554920476f74686963" /&gt;
    &lt;/font&gt;
    &lt;mouseicon&gt;
      &lt;ddsxmlobjectstreamwrapper binary="6c74000000000000" /&gt;
    &lt;/mouseicon&gt;
  &lt;/diagram&gt;
  &lt;layoutmanager&gt;
    &lt;ddsxmlobj /&gt;
  &lt;/layoutmanager&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="スクリプト タスク" left="-3133" top="-2658" logicalid="15" controlid="1" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{DDC5095B-FBCF-4D86-8990-DD04041EBBD9}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="メール送信タスク" left="1258" top="5969" logicalid="16" controlid="2" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{BBBCB8CF-97F3-40E4-A2B6-C5156970BACC}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="新製品インポート" left="5731" top="-2678" logicalid="17" controlid="3" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{3774DD95-5D3F-4370-BA1C-CDD7DA1B48F8}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="製品名インポート" left="677" top="980" logicalid="18" controlid="4" masterid="0" hint1="0" hint2="0" width="4815" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="00080000cf1200008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{FDCD7A46-B313-4638-9AEB-A378FA9604CA}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="エラーメール生成" left="1101" top="3182" logicalid="19" controlid="5" masterid="0" hint1="0" hint2="0" width="4020" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="00080000b40f00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{77FCCB94-C455-471B-8E5B-586EC6B3C783}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="-1733" top="-1893" logicalid="20" controlid="6" masterid="0" hint1="0" hint2="0" width="4117" height="3373" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="255" linestyle="1" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{4BC47838-39B2-435A-9D2B-B6DDCDB69269}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="1" destid="4" sourceattachpoint="7" destattachpoint="4" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="-1334" y="-1494" /&gt;
      &lt;point x="-1334" y="-257" /&gt;
      &lt;point x="1984" y="-257" /&gt;
      &lt;point x="1984" y="980" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="2685" top="1745" logicalid="21" controlid="7" masterid="0" hint1="0" hint2="0" width="826" height="1937" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="16711680" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{80701998-01A3-41D8-8616-5262AB6FE837}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="4" destid="5" sourceattachpoint="9" destattachpoint="6" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="3084" y="2144" /&gt;
      &lt;point x="3084" y="2663" /&gt;
      &lt;point x="3111" y="2663" /&gt;
      &lt;point x="3111" y="3182" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="2658" top="3947" logicalid="22" controlid="8" masterid="0" hint1="0" hint2="0" width="853" height="2522" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="16711680" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1"&gt;
          &lt;adornment percentpos="0" controlid="16" width="423" height="423" side="0" behavior="2" himetric="0" distfromline="175" startobj="0" x="2513" y="4346" visible="1" allowoverlap="1" usepercent="1" /&gt;
        &lt;/polyline&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{A18CDB83-4F19-40C0-A505-ED14E41EBCA4}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="5" destid="2" sourceattachpoint="7" destattachpoint="6" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="3111" y="4346" /&gt;
      &lt;point x="3111" y="5157" /&gt;
      &lt;point x="3057" y="5157" /&gt;
      &lt;point x="3057" y="5969" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="3785" top="-1913" logicalid="23" controlid="9" masterid="0" hint1="0" hint2="0" width="4145" height="3393" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="16711680" linestyle="1" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{62626943-6510-4AA4-BD5D-24A1703C803D}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="3" destid="4" sourceattachpoint="7" destattachpoint="12" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="7530" y="-1514" /&gt;
      &lt;point x="7530" y="-212" /&gt;
      &lt;point x="4184" y="-212" /&gt;
      &lt;point x="4184" y="980" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="スクリプト タスク" left="1312" top="-2679" logicalid="24" controlid="10" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{126FED06-3082-48F1-B0B8-1A448740CABC}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="66" top="-2496" logicalid="25" controlid="11" masterid="0" hint1="0" hint2="0" width="1546" height="820" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="32768" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{A2C2F29F-849E-42FB-9E2A-85400D6AEE81}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="1" destid="10" sourceattachpoint="15" destattachpoint="14" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="465" y="-2076" /&gt;
      &lt;point x="888" y="-2076" /&gt;
      &lt;point x="888" y="-2097" /&gt;
      &lt;point x="1312" y="-2097" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="4511" top="-2496" logicalid="26" controlid="12" masterid="0" hint1="0" hint2="0" width="1520" height="800" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="32768" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{EC18EC4D-C98D-4661-A360-BD68E5D5BA14}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="10" destid="3" sourceattachpoint="15" destattachpoint="14" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="4910" y="-2097" /&gt;
      &lt;point x="5320" y="-2097" /&gt;
      &lt;point x="5320" y="-2096" /&gt;
      &lt;point x="5731" y="-2096" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="2712" top="-1914" logicalid="27" controlid="13" masterid="0" hint1="0" hint2="0" width="1322" height="3394" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="255" linestyle="1" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{4A473EC3-FD02-42BF-8344-DCB2E4479406}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="10" destid="4" sourceattachpoint="7" destattachpoint="10" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="3111" y="-1515" /&gt;
      &lt;point x="3111" y="-267" /&gt;
      &lt;point x="3634" y="-267" /&gt;
      &lt;point x="3634" y="980" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="@[User::Err_Flag] == true" left="2513" top="4346" logicalid="30" controlid="16" masterid="8" hint1="0" hint2="0" width="423" height="423" noresize="1" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="1" selectable="0" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="1" groupcollapsed="0" tabstop="0" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="00080000a7010000a7010000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="RESERVED_IS_DECORATION" value="8" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
&lt;/dds&gt;&lt;/dwd:Layout&gt;&lt;dwd:PersistedViewPortLeft&gt;-4133&lt;/dwd:PersistedViewPortLeft&gt;&lt;dwd:PersistedViewPortTop&gt;-3175&lt;/dwd:PersistedViewPortTop&gt;&lt;/dwd:DtsControlFlowDiagram&gt;&lt;/Package&gt;</DTS:Property><DTS:Property DTS:Name="Namespace">dts-designer-1.0</DTS:Property><DTS:Property DTS:Name="ObjectName">{19D05BC8-92A0-47B5-B85E-BAD0746F3CA5}</DTS:Property><DTS:Property DTS:Name="DTSID">{8AC9EB9D-7A0B-4183-AFD3-17B4AF40DE94}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PackageVariable><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">1041</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8"></DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Comment</DTS:Property><DTS:Property DTS:Name="DTSID">{F1F71E82-5170-4290-8EC0-2D85E1FA864F}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">C:\tcijapp\data\</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Dir_File</DTS:Property><DTS:Property DTS:Name="DTSID">{414111A0-CA85-4D87-A24D-C018CCC3136F}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">C:\tcijapp\Purchase\Batch\log\</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Dir_Log</DTS:Property><DTS:Property DTS:Name="DTSID">{F7830F45-8AEF-4FDE-BF30-F19A70875D1F}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">C:\tcijapp\Purchase\Batch\temp\</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Dir_Temp</DTS:Property><DTS:Property DTS:Name="DTSID">{1550A6FE-1A78-4F3F-BFDD-79C715DC3816}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="7">0:00:00</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">End_Time</DTS:Property><DTS:Property DTS:Name="DTSID">{5C71B5C0-85FF-41BE-869C-5AF6061A0D62}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="11">0</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Err_Flag</DTS:Property><DTS:Property DTS:Name="DTSID">{65D40DAB-A1C4-43BB-9261-7DE9427D4677}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">NewProduct.txt</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">File_New_Product</DTS:Property><DTS:Property DTS:Name="DTSID">{2A061FE5-6239-43AE-844D-C2C08AB20B00}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">JOSYS-8@tokyokasei.co.jp</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Mail_To</DTS:Property><DTS:Property DTS:Name="DTSID">{0DDB909E-0984-41FD-92F0-F84E93D786D2}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="7">2008/07/11</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Start_Time</DTS:Property><DTS:Property DTS:Name="DTSID">{9D2D78BE-E05C-4BBE-9922-20D610D3017A}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">1</DTS:Property><DTS:Property DTS:Name="FilterKind">0</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8">3,7,OnError,13,OnPostExecute,12,OnTaskFailed</DTS:Property><DTS:Property DTS:Name="ColumnFilter" DTS:EventName="OnError"><DTS:Property DTS:Name="Computer">-1</DTS:Property><DTS:Property DTS:Name="Operator">-1</DTS:Property><DTS:Property DTS:Name="SourceName">-1</DTS:Property><DTS:Property DTS:Name="SourceID">-1</DTS:Property><DTS:Property DTS:Name="ExecutionID">-1</DTS:Property><DTS:Property DTS:Name="MessageText">-1</DTS:Property><DTS:Property DTS:Name="DataBytes">-1</DTS:Property></DTS:Property><DTS:Property DTS:Name="ColumnFilter" DTS:EventName="OnPostExecute"><DTS:Property DTS:Name="Computer">-1</DTS:Property><DTS:Property DTS:Name="Operator">-1</DTS:Property><DTS:Property DTS:Name="SourceName">-1</DTS:Property><DTS:Property DTS:Name="SourceID">-1</DTS:Property><DTS:Property DTS:Name="ExecutionID">-1</DTS:Property><DTS:Property DTS:Name="MessageText">-1</DTS:Property><DTS:Property DTS:Name="DataBytes">-1</DTS:Property></DTS:Property><DTS:Property DTS:Name="ColumnFilter" DTS:EventName="OnTaskFailed"><DTS:Property DTS:Name="Computer">-1</DTS:Property><DTS:Property DTS:Name="Operator">-1</DTS:Property><DTS:Property DTS:Name="SourceName">-1</DTS:Property><DTS:Property DTS:Name="SourceID">-1</DTS:Property><DTS:Property DTS:Name="ExecutionID">-1</DTS:Property><DTS:Property DTS:Name="MessageText">-1</DTS:Property><DTS:Property DTS:Name="DataBytes">-1</DTS:Property></DTS:Property></DTS:LoggingOptions>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">0</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">前処理</DTS:Property><DTS:Property DTS:Name="DTSID">{DDC5095B-FBCF-4D86-8990-DD04041EBBD9}</DTS:Property><DTS:Property DTS:Name="Description">スクリプト タスク</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="" ReadWriteVariables="Comment,Start_Time,Dir_File,Dir_Temp,File_New_Product,Err_Flag,Dir_Log"><ProjectItem Name="dts://Scripts/ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Xml
Imports System.Data
Imports System.Math
Imports System.Text.RegularExpressions
Imports Microsoft.SqlServer.Dts.Runtime
Imports System.Data.SqlClient

Public Class ScriptMain


    Public Sub Main()

        ' 開始時間取得
        Dts.Variables("Start_Time").Value = Now()

        ' データベース接続設定
        Dim st_tmp_table As String = "TmpNewProduct"

        ' 変数設定
        Dim st_dir_file As String = Dts.Variables("Dir_File").Value.ToString  ' ファイル出力先パス
        Dim st_dir_temp As String = Dts.Variables("Dir_Temp").Value.ToString  ' 作業ディレクトリ
        Dim st_file_name As String = Dts.Variables("File_New_Product").Value.ToString   ' ファイル名
        Dim stb_error_comments As New Text.StringBuilder() ' DB エラーメッセージ格納用
        Dim stb_comments As New Text.StringBuilder() ' その他処理コメント格納用
        ' 変数設定(ログファイル削除時に使用)
        Dim deldate As Integer = CInt(Format(DateAdd(DateInterval.WeekOfYear, -1, Now()), "yyyyMMdd"))
        Dim delFI As IO.FileInfo
        Dim delfile As String = String.Empty

        ' ログ保存ディレクトリから拡張子 .log のファイルを取得し、
        ' ログファイル名形式とマッチ且つ一週間以上前のファイルを削除。
        For Each path As String In IO.Directory.GetFileSystemEntries(Dts.Variables("Dir_Log").Value.ToString, "*.log")

            delFI = New IO.FileInfo(path)
            delfile = Split(delFI.Name, delFI.Extension)(0)

            If Regex.IsMatch(delfile, "^[0-9]{4}[0-9]{2}[0-9]{2}$") Then
                If CInt(delfile) < deldate Then
                    delFI.Delete()
                End If
            End If

        Next path

        ' オブジェクト FileInfo のインスタンスを生成
        Dim fi_new_product As IO.FileInfo = New IO.FileInfo(st_dir_file & st_file_name)

        ' ファイル存在チェック
        If fi_new_product.Exists = True Then

            ' ファイルアップローディングチェック( 3 秒後のファイルサイズが異なる場合は終了)
            Dim l_file_size As Long = fi_new_product.Length
            System.Threading.Thread.Sleep(3000) ' 3 秒停止

            ' サイズが同じなら作業フォルダにコピー
            If l_file_size = New IO.FileInfo(st_dir_file & st_file_name).Length Then
                fi_new_product.CopyTo(st_dir_temp & st_file_name, True)
                fi_new_product.Delete()
            Else
                stb_error_comments.Append("ファイルアップロード中と判断し処理を終了しました。")
            End If
        Else
            stb_error_comments.Append("ファイルが存在しません" & vbCrLf)
            stb_error_comments.Append(fi_new_product.FullName)
        End If

        ' 処理コメント生成
        If stb_comments.Length > 0 Or stb_error_comments.Length > 0 Then
            stb_comments.Insert(0, "-- 前処理" & vbCrLf)
            stb_comments.Append(stb_error_comments.ToString() & vbCrLf)
            Dts.Variables("Comment").Value = Dts.Variables("Comment").Value.ToString() & vbCrLf & stb_comments.ToString()
        End If

        ' エラーコメントがあった場合はタスク失敗
        If stb_error_comments.Length > 0 Then
            Dts.TaskResult = Dts.Results.Failure
        Else
            Dts.TaskResult = Dts.Results.Success
        End If

    End Sub

End Class]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc/ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{AC7BAFEF-3576-44B9-8F2E-2E5B749BE4EE}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_14b4e0430f2f4a2db8108f4bf2a21acc"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
                <Reference
                    Name = "System.XML"
                    AssemblyName = "System.Xml"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">作業テーブルインポート</DTS:Property><DTS:Property DTS:Name="DTSID">{126FED06-3082-48F1-B0B8-1A448740CABC}</DTS:Property><DTS:Property DTS:Name="Description">スクリプト タスク</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_1bffdc2093464a3aaa435d590aee9efd" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="" ReadWriteVariables="Comment,Start_Time,Dir_File,Dir_Temp,File_New_Product,Err_Flag"><ProjectItem Name="dts://Scripts/ScriptTask_1bffdc2093464a3aaa435d590aee9efd/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Xml
Imports System.Data
Imports System.Math
Imports Microsoft.SqlServer.Dts.Runtime
Imports System.Data.SqlClient
Imports System.Text.RegularExpressions

Public Class ScriptMain

    Public Sub Main()

        ' データベース接続設定
        Dim st_tmp_table As String = "TmpNewProduct"

        ' 変数設定
        Dim st_dir_temp As String = Dts.Variables("Dir_Temp").Value.ToString   ' 作業ディレクトリ
        Dim st_file_name As String = Dts.Variables("File_New_Product").Value.ToString   ' ファイル名
        Dim stb_error_comments As New Text.StringBuilder() ' DB エラーメッセージ格納用
        Dim stb_comments As New Text.StringBuilder() ' その他処理コメント格納用

        ' 作業ディレクトリにコピーしたデータファイルを読込む
        Try
            Using reader As New FileIO.TextFieldParser(st_dir_temp & st_file_name), _
                  connection As SqlConnection = DirectCast(Dts.Connections("ADO.Purchase").AcquireConnection(Dts.Transaction), SqlConnection)

                ' データファイルデリミタ指定
                reader.TextFieldType = FileIO.FieldType.Delimited
                reader.SetDelimiters(vbTab)

                ' DB選択、作業テーブルのデータ消去
                Dim command As New SqlCommand("TRUNCATE TABLE " & st_tmp_table, connection)
                command.ExecuteNonQuery()

                ' SQLパラメータ設定
                Dim sqlp_ProductNumber As SqlParameter = command.Parameters.Add("ProductNumber", SqlDbType.VarChar)
                Dim sqlp_NewProductRegNumber As SqlParameter = command.Parameters.Add("NewProductRegNumber", SqlDbType.VarChar)
                Dim sqlp_ProductName As SqlParameter = command.Parameters.Add("ProductName", SqlDbType.NVarChar)
                Dim sqlp_CASNumber As SqlParameter = command.Parameters.Add("CASNumber", SqlDbType.VarChar)
                Dim sqlp_Status As SqlParameter = command.Parameters.Add("Status", SqlDbType.NVarChar)
                Dim sqlp_ProposalDept As SqlParameter = command.Parameters.Add("ProposalDept", SqlDbType.NVarChar)
                Dim sqlp_ProcumentDept As SqlParameter = command.Parameters.Add("ProcumentDept", SqlDbType.NVarChar)
                Dim sqlp_PD As SqlParameter = command.Parameters.Add("PD", SqlDbType.NVarChar)
                Dim sqlp_MolecularFormula As SqlParameter = command.Parameters.Add("MolecularFormula", SqlDbType.VarChar)

                ' データファイルを一行ずつ読み込み、作業テーブルに挿入していく
                Dim row As String()
                Dim i As Integer
                Dim st_err_line_number As String
                Dim st_err_line_data As String
                Dim utf8 As System.Text.Encoding = System.Text.Encoding.GetEncoding("UTF-8")
                Dim ucs2 As System.Text.Encoding = System.Text.Encoding.GetEncoding("UCS-2")

                While Not reader.EndOfData
                    Try
                        ' 一行読込む
                        row = reader.ReadFields()

                        For i = 0 To UBound(row)
                            If Not String.IsNullOrEmpty(row(i)) Then
                                row(i) = ucs2.GetString(System.Text.Encoding.Convert(utf8, ucs2, utf8.GetBytes(row(i))))
                            End If
                        Next i

                        st_err_line_number = reader.LineNumber - 1 & " 行目の"
                        st_err_line_data = row(0) & vbTab & row(1) & vbTab & row(3) & vbCrLf

                        ' バリデート
                        ' 製品コード
                        If Not row(0) = "$" Then
                            If Not Regex.IsMatch(row(0), "^[A-Z][0-9][0-9][0-9][0-9]") Then
                                stb_comments.Append(st_err_line_number & " 製品コード が不正です: " & st_err_line_data)
                                Dts.Variables("Err_Flag").Value = True
                                Continue While
                            End If
                        End If

                        ' 新製品登録番号
                        If Not row(1) = "$" Then
                            If Not Regex.IsMatch(row(1), "^[A-Z0-9][0-9]{9}$") Then
                                stb_comments.Append(st_err_line_number & " 新製品登録番号 が不正です: " & st_err_line_data)
                                Dts.Variables("Err_Flag").Value = True
                                Continue While
                            End If
                        End If

                        ' CASナンバー
                        If Not String.IsNullOrEmpty(row(3)) Then
                            If Not Regex.IsMatch(row(3), "^[0-9]+\-[0-9]{2}\-[0-9]$") Then
                                stb_comments.Append(st_err_line_number & " CAS 番号 が不正です: " & st_err_line_data)
                                Dts.Variables("Err_Flag").Value = True
                                Continue While
                            End If
                        End If

                        ' SQLパラメータに追加
                        sqlp_ProductNumber.Value = IIf(row(0) = "$", DBNull.Value, row(0))
                        sqlp_NewProductRegNumber.Value = IIf(row(1) = "$", DBNull.Value, row(1))
                        sqlp_ProductName.Value = IIf(String.IsNullOrEmpty(row(2)), DBNull.Value, row(2))
                        sqlp_CASNumber.Value = IIf(String.IsNullOrEmpty(row(3)), DBNull.Value, row(3))
                        sqlp_Status.Value = IIf(String.IsNullOrEmpty(row(4)), DBNull.Value, row(4))
                        sqlp_ProposalDept.Value = IIf(String.IsNullOrEmpty(row(5)), DBNull.Value, row(5))
                        sqlp_ProcumentDept.Value = IIf(String.IsNullOrEmpty(row(6)), DBNull.Value, row(6))
                        sqlp_PD.Value = IIf(String.IsNullOrEmpty(row(7)), DBNull.Value, row(7))
                        sqlp_MolecularFormula.Value = IIf(String.IsNullOrEmpty(row(8)), DBNull.Value, row(8))

                        ' INSERT 文を生成し、実行
                        command.CommandText = _
                          "INSERT INTO " & st_tmp_table & " " _
                        & "(ProductNumber,NewProductRegNumber,ProductName,CASNumber,Status,ProposalDept,ProcumentDept,PD,MolecularFormula,ImportStatus,CreateDate) " _
                        & " VALUES (@ProductNumber,@NewProductRegNumber,@ProductName,@CASNumber,@Status,@ProposalDept,@ProcumentDept,@PD,@MolecularFormula,'1',GETDATE())"
                        command.ExecuteNonQuery()

                    Catch e As FileIO.MalformedLineException
                        stb_comments.Append("Line " & reader.ErrorLine & " is not valid.")
                        Dts.Variables("Err_Flag").Value = True
                    End Try
                End While
            End Using

        Catch e As Exception
            stb_error_comments.Append(e.ToString())
            Dts.Variables("Err_Flag").Value = True
        End Try

        ' 処理コメント生成
        If stb_comments.Length > 0 Or stb_error_comments.Length > 0 Then
            stb_comments.Insert(0, "-- 作業テーブルインポート" & vbCrLf)
            stb_comments.Append(stb_error_comments.ToString() & vbCrLf)
            Dts.Variables("Comment").Value = Dts.Variables("Comment").Value.ToString() & vbCrLf & stb_comments.ToString()
        End If

        ' エラーコメントがあった場合はエラー終了
        If stb_error_comments.Length > 0 Then
            Dts.TaskResult = Dts.Results.Failure
        Else
            Dts.TaskResult = Dts.Results.Success
        End If

    End Sub

End Class]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_1bffdc2093464a3aaa435d590aee9efd/ScriptTask_1bffdc2093464a3aaa435d590aee9efd.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{00000000-0000-0000-0000-000000000000}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_1bffdc2093464a3aaa435d590aee9efd"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_1bffdc2093464a3aaa435d590aee9efd"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_1bffdc2093464a3aaa435d590aee9efd"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">0</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">新製品インポート</DTS:Property><DTS:Property DTS:Name="DTSID">{3774DD95-5D3F-4370-BA1C-CDD7DA1B48F8}</DTS:Property><DTS:Property DTS:Name="Description">新製品インポート</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_a4658be98608414c89574ae7a889c28f" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="" ReadWriteVariables="Comment,Err_Flag"><ProjectItem Name="dts://Scripts/ScriptTask_a4658be98608414c89574ae7a889c28f/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Xml
Imports System.Data
Imports System.Math
Imports Microsoft.SqlServer.Dts.Runtime
Imports System.Data.SqlClient

Public Class ScriptMain


    Public Sub Main()

        ' 変数設定
        Dim stb_error_comments As New Text.StringBuilder() ' DB エラーメッセージ格納用
        Dim stb_comments As New Text.StringBuilder() ' その他処理コメント格納用

        Try
            Using connection As SqlConnection = DirectCast(Dts.Connections("ADO.Purchase").AcquireConnection(Dts.Transaction), SqlConnection)

                ' ストアド　プロシージャ実行
                Dim command As New SqlCommand("sp_NewProductImport", connection) ' コマンド定義 
                command.CommandType = CommandType.StoredProcedure ' コマンドタイプをストアドプロシージャに指定
                Dim RETURN_VALUE As SqlParameter = command.Parameters.Add("RETURN_VALUE", SqlDbType.Int) ' ストアドプロシージャからRETURN値(@RETURN_VALUE)を取得する変数
                Dim ErNUMBER As SqlParameter = command.Parameters.Add("ErNUMBER", SqlDbType.Int)
                Dim ErSTATE As SqlParameter = command.Parameters.Add("ErSTATE", SqlDbType.Int)
                Dim ErLINE As SqlParameter = command.Parameters.Add("ErLINE", SqlDbType.Int)
                Dim ErMESSAGE As SqlParameter = command.Parameters.Add("ErMESSAGE", SqlDbType.NVarChar, 2000)
                Dim ErPNumber As SqlParameter = command.Parameters.Add("ErPNumber", SqlDbType.NVarChar, 2000)

                RETURN_VALUE.Direction = ParameterDirection.ReturnValue
                ErNUMBER.Direction = ParameterDirection.Output
                ErSTATE.Direction = ParameterDirection.Output
                ErLINE.Direction = ParameterDirection.Output
                ErMESSAGE.Direction = ParameterDirection.Output
                ErPNumber.Direction = ParameterDirection.Output

                command.ExecuteNonQuery() ' ストアドプロシージャの実行

                ' Error処理
                If CInt(RETURN_VALUE.Value) = 0 Then  ' ストアドプロシージャ戻り値チェック
                    If Not IsDBNull(ErPNumber.Value) Then
                        stb_comments.Append(CStr(ErPNumber.Value) & vbCrLf)
                    End If
                Else
                    stb_error_comments.Append("ERROR NUMBER  : " & CStr(ErNUMBER.Value) & vbCrLf)
                    stb_error_comments.Append("ERROR STATE   : " & CStr(ErSTATE.Value) & vbCrLf)
                    stb_error_comments.Append("ERROR LINE    : " & CStr(ErLINE.Value) & vbCrLf)
                    stb_error_comments.Append("ERROR MESSAGE : " & CStr(ErMESSAGE.Value) & vbCrLf)
                    stb_error_comments.Append(command.CommandText & vbCrLf)
                End If
            End Using

        Catch e As Exception
            stb_error_comments.Append(e.ToString())
        End Try

        ' 処理コメント生成
        If stb_comments.Length > 0 Or stb_error_comments.Length > 0 Then
            stb_comments.Insert(0, "-- 新製品インポート" & vbCrLf)
            stb_comments.Append(stb_error_comments.ToString() & vbCrLf)
            Dts.Variables("Comment").Value = Dts.Variables("Comment").Value.ToString() & vbCrLf & stb_comments.ToString()
            Dts.Variables("Err_Flag").Value = True
        End If

        ' エラーコメントがあった場合はタスク失敗。
        If stb_error_comments.Length > 0 Then
            Dts.TaskResult = Dts.Results.Failure
        Else
            Dts.TaskResult = Dts.Results.Success
        End If

    End Sub

End Class]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_a4658be98608414c89574ae7a889c28f/ScriptTask_a4658be98608414c89574ae7a889c28f.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{A1774900-DBA5-4246-9192-3192B6227E59}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_a4658be98608414c89574ae7a889c28f"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_a4658be98608414c89574ae7a889c28f"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_a4658be98608414c89574ae7a889c28f"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
                <Reference
                    Name = "System.XML"
                    AssemblyName = "System.Xml"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="1"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">0</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">製品名インポート</DTS:Property><DTS:Property DTS:Name="DTSID">{FDCD7A46-B313-4638-9AEB-A378FA9604CA}</DTS:Property><DTS:Property DTS:Name="Description">製品名インポート</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_f8dac7879364440e97a6773a51a374da" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="" ReadWriteVariables="Comment,Err_Flag"><ProjectItem Name="dts://Scripts/ScriptTask_f8dac7879364440e97a6773a51a374da/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Xml
Imports System.Data
Imports System.Math
Imports Microsoft.SqlServer.Dts.Runtime
Imports System.Data.SqlClient

Public Class ScriptMain


    Public Sub Main()

        ' データベース接続設定
        Dim st_tmp_table As String = "TmpNewProduct"

        ' 変数設定
        Dim stb_error_comments As New Text.StringBuilder() ' DB エラーメッセージ格納用
        Dim stb_comments As New Text.StringBuilder() ' その他処理コメント格納用

        Try
            Using connection As SqlConnection = DirectCast(Dts.Connections("ADO.Purchase").AcquireConnection(Dts.Transaction), SqlConnection)

                Dim command As New SqlCommand("sp_ProductNameImport", connection) 'コマンド定義
                command.CommandType = CommandType.StoredProcedure 'コマンドタイプをストアドプロシージャに指定
                Dim RETURN_VALUE As SqlParameter = command.Parameters.Add("RETURN_VALUE", SqlDbType.Int) 'ストアドプロシージャからRETURN値(@RETURN_VALUE)を取得する変数
                Dim ErNUMBER As SqlParameter = command.Parameters.Add("ErNUMBER", SqlDbType.Int)
                Dim ErSTATE As SqlParameter = command.Parameters.Add("ErSTATE", SqlDbType.Int)
                Dim ErLINE As SqlParameter = command.Parameters.Add("ErLINE", SqlDbType.Int)
                Dim ErMESSAGE As SqlParameter = command.Parameters.Add("ErMESSAGE", SqlDbType.NVarChar, 2000)

                RETURN_VALUE.Direction = ParameterDirection.ReturnValue
                ErNUMBER.Direction = ParameterDirection.Output
                ErSTATE.Direction = ParameterDirection.Output
                ErLINE.Direction = ParameterDirection.Output
                ErMESSAGE.Direction = ParameterDirection.Output

                command.ExecuteNonQuery() ' ストアドプロシージャの実行

                'Error処理 
                If CInt(RETURN_VALUE.Value) = 0 Then
                    ' なにもしない
                Else
                    stb_error_comments.Append("ERROR NUMBER  : " & CStr(ErNUMBER.Value) & vbCrLf)
                    stb_error_comments.Append("ERROR STATE   : " & CStr(ErSTATE.Value) & vbCrLf)
                    stb_error_comments.Append("ERROR LINE    : " & CStr(ErLINE.Value) & vbCrLf)
                    stb_error_comments.Append("ERROR MESSAGE : " & CStr(ErMESSAGE.Value) & vbCrLf)
                    stb_error_comments.Append(command.CommandText & vbCrLf)
                End If
            End Using

        Catch e As Exception
            stb_error_comments.Append(e.ToString())
        End Try

        ' 処理コメント生成
        If stb_comments.Length > 0 Or stb_error_comments.Length > 0 Then
            stb_comments.Insert(0, "-- 製品名インポート" & vbCrLf)
            stb_comments.Append(stb_error_comments.ToString() & vbCrLf)
            Dts.Variables("Comment").Value = Dts.Variables("Comment").Value.ToString() & vbCrLf & stb_comments.ToString()
            Dts.Variables("Err_Flag").Value = True
        End If

        ' エラーコメントがあった場合はタスク失敗。
        If stb_error_comments.Length > 0 Then
            Dts.TaskResult = Dts.Results.Failure
        Else
            Dts.TaskResult = Dts.Results.Success
        End If

    End Sub

End Class]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_f8dac7879364440e97a6773a51a374da/ScriptTask_f8dac7879364440e97a6773a51a374da.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{00000000-0000-0000-0000-000000000000}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_f8dac7879364440e97a6773a51a374da"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_f8dac7879364440e97a6773a51a374da"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_f8dac7879364440e97a6773a51a374da"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
                <Reference
                    Name = "System.XML"
                    AssemblyName = "System.Xml"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="1"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">0</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">終了メッセージ生成</DTS:Property><DTS:Property DTS:Name="DTSID">{77FCCB94-C455-471B-8E5B-586EC6B3C783}</DTS:Property><DTS:Property DTS:Name="Description">エラーメール生成</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="" ReadWriteVariables="Comment,Start_Time,End_Time,Err_Flag,Dir_Log"><ProjectItem Name="dts://Scripts/ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Data
Imports System.Math
Imports System.IO
Imports Microsoft.SqlServer.Dts.Runtime

Public Class ScriptMain

    Public Sub Main()

        Dim stb_log As New Text.StringBuilder
        Dim file_log As String = Dts.Variables("Dir_Log").Value.ToString & Format(Now(), "yyyyMMdd") & ".log"

        ' 処理結果コメント生成
        Dts.Variables("End_Time").Value = Now()
        stb_log.Append("[Purchase] 製品インポート" & vbCrLf)
        stb_log.Append("開始時刻: " & Dts.Variables("Start_Time").Value.ToString & vbCrLf)
        stb_log.Append("終了時刻: " & Dts.Variables("End_Time").Value.ToString & vbCrLf & vbCrLf)
        stb_log.Append(Dts.Variables("Comment").Value.ToString)

        ' ログ書き込み
        Using sw As StreamWriter = File.AppendText(file_log)
            sw.WriteLine(stb_log.ToString)
            sw.WriteLine("-------------------------------")
            sw.Flush()
            sw.Close()
        End Using

        ' エラーがあった場合はメール送信
        If CBool(Dts.Variables("Err_Flag").Value) Then
            Dts.Variables("Comment").Value = stb_log.ToString
        End If

        Dts.TaskResult = Dts.Results.Success
    End Sub

End Class]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4/ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{9B24034E-AF45-424D-B7E3-7DA713BB2B55}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_c09b31fe2d8b43f6afc84deb91c5a6d4"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.SendMailTask.SendMailTask, Microsoft.SqlServer.SendMailTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="1"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact">Send Mail Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1</DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">0</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:PropertyExpression DTS:Name="ToLine">@[User::Mail_To]</DTS:PropertyExpression><DTS:Property DTS:Name="ObjectName">メール送信タスク</DTS:Property><DTS:Property DTS:Name="DTSID">{BBBCB8CF-97F3-40E4-A2B6-C5156970BACC}</DTS:Property><DTS:Property DTS:Name="Description">メール送信タスク</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.SendMailTask.SendMailTask, Microsoft.SqlServer.SendMailTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><SendMailTask:SendMailTaskData SendMailTask:SMTPServer="{0558022D-9833-4694-B076-1EBC3ECE55AD}" SendMailTask:From="app@tokyokasei.co.jp" SendMailTask:To="JOSYS-8@tokyokasei.co.jp" SendMailTask:CC="" SendMailTask:BCC="" SendMailTask:Subject="[Purchase] 製品インポートでエラーが発生しました" SendMailTask:Priority="High" SendMailTask:MessageSourceType="Variable" SendMailTask:MessageSource="User::Comment" xmlns:SendMailTask="www.microsoft.com/sqlserver/dts/tasks/sendmailtask"/></DTS:ObjectData></DTS:Executable>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">1</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">0</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{DDC5095B-FBCF-4D86-8990-DD04041EBBD9}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{FDCD7A46-B313-4638-9AEB-A378FA9604CA}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約</DTS:Property><DTS:Property DTS:Name="DTSID">{4BC47838-39B2-435A-9D2B-B6DDCDB69269}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">2</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{FDCD7A46-B313-4638-9AEB-A378FA9604CA}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{77FCCB94-C455-471B-8E5B-586EC6B3C783}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 1</DTS:Property><DTS:Property DTS:Name="DTSID">{80701998-01A3-41D8-8616-5262AB6FE837}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">0</DTS:Property><DTS:Property DTS:Name="EvalOp">1</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression">@[User::Err_Flag] == true</DTS:Property><DTS:Executable IDREF="{77FCCB94-C455-471B-8E5B-586EC6B3C783}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{BBBCB8CF-97F3-40E4-A2B6-C5156970BACC}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 2</DTS:Property><DTS:Property DTS:Name="DTSID">{A18CDB83-4F19-40C0-A505-ED14E41EBCA4}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">2</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">0</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{3774DD95-5D3F-4370-BA1C-CDD7DA1B48F8}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{FDCD7A46-B313-4638-9AEB-A378FA9604CA}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 4</DTS:Property><DTS:Property DTS:Name="DTSID">{62626943-6510-4AA4-BD5D-24A1703C803D}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">0</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{DDC5095B-FBCF-4D86-8990-DD04041EBBD9}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{126FED06-3082-48F1-B0B8-1A448740CABC}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 3</DTS:Property><DTS:Property DTS:Name="DTSID">{A2C2F29F-849E-42FB-9E2A-85400D6AEE81}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">0</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{126FED06-3082-48F1-B0B8-1A448740CABC}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{3774DD95-5D3F-4370-BA1C-CDD7DA1B48F8}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 5</DTS:Property><DTS:Property DTS:Name="DTSID">{EC18EC4D-C98D-4661-A360-BD68E5D5BA14}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">1</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">0</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{126FED06-3082-48F1-B0B8-1A448740CABC}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{FDCD7A46-B313-4638-9AEB-A378FA9604CA}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 6</DTS:Property><DTS:Property DTS:Name="DTSID">{4A473EC3-FD02-42BF-8344-DCB2E4479406}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint><DTS:Property DTS:Name="ObjectName">ProductImport</DTS:Property><DTS:Property DTS:Name="DTSID">{19D05BC8-92A0-47B5-B85E-BAD0746F3CA5}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName">MSDTS.Package.1</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property></DTS:Executable>