<?xml version="1.0"?><DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts" DTS:ExecutableType="MSDTS.Package.1"><DTS:Property DTS:Name="PackageFormatVersion">2</DTS:Property><DTS:Property DTS:Name="VersionComments"></DTS:Property><DTS:Property DTS:Name="CreatorName">TCI\JOSYS-07</DTS:Property><DTS:Property DTS:Name="CreatorComputerName">HS-SYS0245</DTS:Property><DTS:Property DTS:Name="CreationDate" DTS:DataType="7">5/28/2008 5:56:05 PM</DTS:Property><DTS:Property DTS:Name="PackageType">5</DTS:Property><DTS:Property DTS:Name="ProtectionLevel">0</DTS:Property><DTS:Property DTS:Name="MaxConcurrentExecutables">-1</DTS:Property><DTS:Property DTS:Name="PackagePriorityClass">0</DTS:Property><DTS:Property DTS:Name="VersionMajor">1</DTS:Property><DTS:Property DTS:Name="VersionMinor">0</DTS:Property><DTS:Property DTS:Name="VersionBuild">64</DTS:Property><DTS:Property DTS:Name="VersionGUID">{FD45AA16-C4FA-4798-A617-61C00BAE43B2}</DTS:Property><DTS:Property DTS:Name="EnableConfig">-1</DTS:Property><DTS:Property DTS:Name="CheckpointFileName"></DTS:Property><DTS:Property DTS:Name="SaveCheckpoints">0</DTS:Property><DTS:Property DTS:Name="CheckpointUsage">0</DTS:Property><DTS:Property DTS:Name="SuppressConfigurationWarnings">0</DTS:Property>
<DTS:ConnectionManager><DTS:Property DTS:Name="DelayValidation">0</DTS:Property><DTS:Property DTS:Name="ObjectName">ADO.Purchase</DTS:Property><DTS:Property DTS:Name="DTSID">{EC9B29DE-F3C3-488F-A962-27F13F201CC7}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName">ADO.NET:System.Data.SqlClient.SqlConnection, System.Data, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</DTS:Property><DTS:ObjectData><DTS:ConnectionManager><DTS:Password DTS:Name="Password" Sensitive="1"></DTS:Password><DTS:Property DTS:Name="ConnectionString">Data Source=tcij-08049;User ID=Purchase;Initial Catalog=Purchase;Persist Security Info=True;</DTS:Property></DTS:ConnectionManager></DTS:ObjectData></DTS:ConnectionManager>
<DTS:ConnectionManager><DTS:Property DTS:Name="DelayValidation">0</DTS:Property><DTS:Property DTS:Name="ObjectName">SMTP</DTS:Property><DTS:Property DTS:Name="DTSID">{E271125B-E698-49A8-B2B0-0B0D1949DB2C}</DTS:Property><DTS:Property DTS:Name="Description">PurchaseDB SupplierImport.dtsx エラーメール送信</DTS:Property><DTS:Property DTS:Name="CreationName">SMTP</DTS:Property><DTS:ObjectData><SmtpConnectionManager ConnectionString="SmtpServer=tex1.tci.tokyokasei;UseWindowsAuthentication=True;EnableSsl=False;"/></DTS:ObjectData></DTS:ConnectionManager>
<DTS:Configuration><DTS:Property DTS:Name="ConfigurationType">1</DTS:Property><DTS:Property DTS:Name="ConfigurationString">C:\tcijapp\Purchase\Batch\Purchase\SupplierImport.dtsConfig</DTS:Property><DTS:Property DTS:Name="ConfigurationVariable"></DTS:Property><DTS:Property DTS:Name="ObjectName">構成 1</DTS:Property><DTS:Property DTS:Name="DTSID">{5A64896D-104C-4B5D-86C7-6C255D729356}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Configuration>
<DTS:PackageVariable><DTS:Property DTS:Name="PackageVariableValue" DTS:DataType="8">&lt;Package xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:dwd="http://schemas.microsoft.com/DataWarehouse/Designer/1.0"&gt;&lt;dwd:DtsControlFlowDiagram&gt;&lt;dwd:BoundingTop&gt;1000&lt;/dwd:BoundingTop&gt;&lt;dwd:Layout&gt;&lt;dds&gt;
  &lt;diagram fontclsid="{0BE35203-8F91-11CE-9DE3-00AA004BB851}" mouseiconclsid="{0BE35204-8F91-11CE-9DE3-00AA004BB851}" defaultlayout="Microsoft.DataWarehouse.Layout.GraphLayout" defaultlineroute="Microsoft.DataWarehouse.Layout.GraphLayout" version="7" nextobject="17" scale="100" pagebreakanchorx="0" pagebreakanchory="0" pagebreaksizex="0" pagebreaksizey="0" scrollleft="0" scrolltop="0" gridx="150" gridy="150" marginx="1000" marginy="1000" zoom="100" x="19897" y="15028" backcolor="15334399" defaultpersistence="2" PrintPageNumbersMode="3" PrintMarginTop="0" PrintMarginBottom="635" PrintMarginLeft="0" PrintMarginRight="0" marqueeselectionmode="1" mousepointer="0" snaptogrid="0" autotypeannotation="1" showscrollbars="0" viewpagebreaks="0" donotforceconnectorsbehindshapes="1" backpictureclsid="{00000000-0000-0000-0000-000000000000}"&gt;
    &lt;font&gt;
      &lt;ddsxmlobjectstreamwrapper binary="010100009001905f01000c4d5320554920476f74686963" /&gt;
    &lt;/font&gt;
    &lt;mouseicon&gt;
      &lt;ddsxmlobjectstreamwrapper binary="6c74000000000000" /&gt;
    &lt;/mouseicon&gt;
  &lt;/diagram&gt;
  &lt;layoutmanager&gt;
    &lt;ddsxmlobj /&gt;
  &lt;/layoutmanager&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="スクリプト タスク" left="0" top="1000" logicalid="7" controlid="1" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{988D1188-F12A-4350-93B6-B62D3D3AFBAA}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="メール送信タスク" left="10242" top="1106" logicalid="8" controlid="2" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{2F30E273-A823-49CE-AB13-376E0394D36D}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="終了メッセージ生成" left="4975" top="1032" logicalid="9" controlid="3" masterid="0" hint1="0" hint2="0" width="3598" height="1164" noresize="0" nomove="0" nodefaultattachpoints="0" autodrag="1" usedefaultiddshape="1" selectable="1" showselectionhandles="1" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="000800000e0e00008c040000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{01CB9142-0D89-4315-AE83-D141895537A9}" vartype="8" /&gt;
        &lt;property name="ShowConnectorSource" value="0" vartype="2" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="3199" top="1183" logicalid="10" controlid="4" masterid="0" hint1="0" hint2="0" width="2076" height="831" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="16711680" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{6E54981B-18CE-44B4-9AB0-B8BB858B9029}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="1" destid="3" sourceattachpoint="15" destattachpoint="14" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="3598" y="1582" /&gt;
      &lt;point x="4286" y="1582" /&gt;
      &lt;point x="4286" y="1614" /&gt;
      &lt;point x="4975" y="1614" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="MSDDS.Polyline" left="8174" top="1215" logicalid="11" controlid="5" masterid="0" hint1="0" hint2="0" width="2368" height="873" noresize="0" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="0" selectable="1" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="0" groupcollapsed="0" tabstop="1" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobj&gt;
        &lt;polyline endtypedst="3" endtypesrc="1" usercolor="16711680" linestyle="0" linerender="2" customendtypedstid="0" customendtypesrcid="0" adornsvisible="1"&gt;
          &lt;adornment percentpos="0" controlid="8" width="423" height="423" side="0" behavior="2" himetric="0" distfromline="175" startobj="0" x="8573" y="1789" visible="1" allowoverlap="1" usepercent="1" /&gt;
        &lt;/polyline&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="LogicalObject" value="{81CFFE4B-CB0B-4CD3-B895-919BAB86580A}" vartype="8" /&gt;
        &lt;property name="Virtual" value="0" vartype="11" /&gt;
        &lt;property name="VisibleAP" value="0" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;connector lineroutestyle="Microsoft.DataWarehouse.Layout.GraphLayout" sourceid="3" destid="2" sourceattachpoint="15" destattachpoint="14" segmenteditmode="0" bendpointeditmode="0" bendpointvisibility="2" relatedid="0" virtual="0"&gt;
      &lt;point x="8573" y="1614" /&gt;
      &lt;point x="9407" y="1614" /&gt;
      &lt;point x="9407" y="1688" /&gt;
      &lt;point x="10242" y="1688" /&gt;
    &lt;/connector&gt;
  &lt;/ddscontrol&gt;
  &lt;ddscontrol controlprogid="DdsShapes.DdsObjectManagedBridge.1" tooltip="@[User::Err_Flag] == True" left="8573" top="1789" logicalid="14" controlid="8" masterid="5" hint1="0" hint2="0" width="423" height="423" noresize="1" nomove="0" nodefaultattachpoints="1" autodrag="0" usedefaultiddshape="1" selectable="0" showselectionhandles="0" allownudging="1" isannotation="0" dontautolayout="1" groupcollapsed="0" tabstop="0" visible="1" snaptogrid="0"&gt;
    &lt;control&gt;
      &lt;ddsxmlobjectstreaminitwrapper binary="00080000a7010000a7010000" /&gt;
    &lt;/control&gt;
    &lt;layoutobject&gt;
      &lt;ddsxmlobj&gt;
        &lt;property name="RESERVED_IS_DECORATION" value="5" vartype="3" /&gt;
      &lt;/ddsxmlobj&gt;
    &lt;/layoutobject&gt;
    &lt;shape groupshapeid="0" groupnode="0" /&gt;
  &lt;/ddscontrol&gt;
&lt;/dds&gt;&lt;/dwd:Layout&gt;&lt;/dwd:DtsControlFlowDiagram&gt;&lt;/Package&gt;</DTS:Property><DTS:Property DTS:Name="Namespace">dts-designer-1.0</DTS:Property><DTS:Property DTS:Name="ObjectName">{23F09C9A-DF24-49D4-8292-E077E4F563AA}</DTS:Property><DTS:Property DTS:Name="DTSID">{E6CAB936-9C1B-4234-AC3F-5A9B3D1C4839}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PackageVariable><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">1041</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8"></DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Comment</DTS:Property><DTS:Property DTS:Name="DTSID">{23AF382E-E022-4D59-9631-F9130599F6D1}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">C:\tcijapp\Purchase\Batch\log\</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Dir_Log</DTS:Property><DTS:Property DTS:Name="DTSID">{6E8DF1B1-135D-4310-832B-54E5FDE9F703}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="7">0:00:00</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">End_Time</DTS:Property><DTS:Property DTS:Name="DTSID">{28F524E4-4581-41B2-8DA0-2020F0FEA3AB}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="11">0</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Err_Flag</DTS:Property><DTS:Property DTS:Name="DTSID">{A12CAE84-9800-4E91-82C7-4C6CD3D88358}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="8">JOSYS-8@tokyokasei.co.jp</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Mail_To</DTS:Property><DTS:Property DTS:Name="DTSID">{A9879246-3B3D-45EC-89A2-609BCAE9F23B}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="3">40</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">SPTimeOut</DTS:Property><DTS:Property DTS:Name="DTSID">{65E8956C-DA2A-46D6-9F74-8337805DFC48}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:Variable><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Property DTS:Name="EvaluateAsExpression">0</DTS:Property><DTS:Property DTS:Name="Namespace">User</DTS:Property><DTS:Property DTS:Name="ReadOnly">0</DTS:Property><DTS:Property DTS:Name="RaiseChangedEvent">0</DTS:Property><DTS:VariableValue DTS:DataType="7">2008/07/11</DTS:VariableValue><DTS:Property DTS:Name="ObjectName">Start_Time</DTS:Property><DTS:Property DTS:Name="DTSID">{BA23FC82-AB15-487A-BE60-D953D5E502A6}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:Variable>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">スクリプト タスク</DTS:Property><DTS:Property DTS:Name="DTSID">{988D1188-F12A-4350-93B6-B62D3D3AFBAA}</DTS:Property><DTS:Property DTS:Name="Description">スクリプト タスク</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_9e65551ff303482f84e792f7451c76bd" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="SPTimeOut" ReadWriteVariables="Comment,Start_Time,Err_Flag,Dir_Log"><ProjectItem Name="dts://Scripts/ScriptTask_9e65551ff303482f84e792f7451c76bd/ScriptTask_9e65551ff303482f84e792f7451c76bd.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{1CA212F3-6D81-4083-8296-54C69D2DD962}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_9e65551ff303482f84e792f7451c76bd"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_9e65551ff303482f84e792f7451c76bd"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_9e65551ff303482f84e792f7451c76bd"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
                <Reference
                    Name = "System.XML"
                    AssemblyName = "System.Xml"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_9e65551ff303482f84e792f7451c76bd/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Xml
Imports System.Data
Imports System.Math
Imports System.Text.RegularExpressions
Imports Microsoft.SqlServer.Dts.Runtime
Imports System.Data.SqlClient

'*&---------------------------------------------------------------------*
'*& プログラム：接続マネージャ指定タスク    　　                        *
'*& 作成者　　：hashimoto / tci                                         *
'*& 作成日付　：2008/05/30                                              *
'*& 管理番号　：                                                        *
'*& 機能番号　：                                                        *
'*&---------------------------------------------------------------------*
'*& 処理概要&                                                           *
'*&    1) 接続マネージャーのConnectionString値設定                      *
'*&    2) Main処理　　　　　　　　　　　　　　　　　　　　              *
'*&    3) Eorror処理                                                    *
'*&                                                                     *
'*&---------------------------------------------------------------------*
'*& 更新履歴&                                                           *
'*& 更新日付　更新者　　更新内容                                        *
'*&                                                                     *
'*&---------------------------------------------------------------------*


Public Class ScriptMain


    Public Sub Main()

        Dim DBConnString As String '接続文字列	
        Dim DBConn As New System.Data.SqlClient.SqlConnection   'データベースコネクション	
        Dim DBCommand As System.Data.SqlClient.SqlCommand       'データベースコマンド		
        Dim MyCom As SqlCommand
        Dts.Variables("Start_Time").Value = Now()
        ' 変数設定(ログファイル削除時に使用)
        Dim deldate As Integer = CInt(Format(DateAdd(DateInterval.WeekOfYear, -1, Now()), "yyyyMMdd"))
        Dim delFI As IO.FileInfo
        Dim delfile As String = String.Empty

        ' ログ保存ディレクトリから拡張子 .log のファイルを取得し、
        ' ログファイル名形式とマッチ且つ一週間以上前のファイルを削除。
        For Each path As String In IO.Directory.GetFileSystemEntries(Dts.Variables("Dir_Log").Value.ToString, "*.log")

            delFI = New IO.FileInfo(path)
            delfile = Split(delFI.Name, delFI.Extension)(0)

            If Regex.IsMatch(delfile, "^[0-9]{4}[0-9]{2}[0-9]{2}$") Then
                If CInt(delfile) < deldate Then
                    delFI.Delete()
                End If
            End If

        Next path

        '*&---------------------------------------------------------------------*
        '*& SQL接続                                                             *
        '*&---------------------------------------------------------------------*
        Try
            DBConn = _
                DirectCast(Dts.Connections("ADO.Purchase").AcquireConnection(Dts.Transaction), _
                SqlClient.SqlConnection)
            DBCommand = DBConn.CreateCommand()

            '***** 2) Main処理 *****
            '*&---------------------------------------------------------------------*
            '*& ストアドプロシジャー実行                                            *
            '*&---------------------------------------------------------------------*
            MyCom = New SqlCommand("sp_SupplierImport", DBConn)                           'コマンド定義 
            MyCom.CommandType = CommandType.StoredProcedure                               'コマンドタイプをストアドプロシージャに指定
            Dim RETURN_VALUE As SqlParameter = MyCom.Parameters.Add("RETURN_VALUE", SqlDbType.Int) 'ストアドプロシージャからRETURN値(@RETURN_VALUE)を取得する変数
            Dim ErNUMBER As SqlParameter = MyCom.Parameters.Add("ErNUMBER", SqlDbType.Int)
            Dim ErSTATE As SqlParameter = MyCom.Parameters.Add("ErSTATE", SqlDbType.Int)
            Dim ErLINE As SqlParameter = MyCom.Parameters.Add("ErLINE", SqlDbType.Int)
            Dim ErMESSAGE As SqlParameter = MyCom.Parameters.Add("ErMESSAGE", SqlDbType.NVarChar, 2000)
            Dim ErPCOUNTRY As SqlParameter = MyCom.Parameters.Add("ErPCOUNTRY", SqlDbType.NVarChar, 2000)

            RETURN_VALUE.Direction = ParameterDirection.ReturnValue
            ErNUMBER.Direction = ParameterDirection.Output
            ErSTATE.Direction = ParameterDirection.Output
            ErLINE.Direction = ParameterDirection.Output
            ErMESSAGE.Direction = ParameterDirection.Output
            ErPCOUNTRY.Direction = ParameterDirection.Output

            MyCom.CommandTimeout = CInt(Dts.Variables("SPTimeOut").Value)
            MyCom.ExecuteNonQuery()                                                        'ストアドプロシージャの実行

            '***** 3) Eorror処理 *****
            If CInt(RETURN_VALUE.Value) = 0 Then                  'ストアドプロシージャ戻り値チェック
                If Not IsDBNull(ErPCOUNTRY.Value) Then
                    Dts.Variables("Comment").Value = CStr(ErPCOUNTRY.Value) & vbCrLf
                    Dts.Variables("Err_Flag").Value = True
                End If
                Dts.TaskResult = Dts.Results.Success
            Else
                Dts.Variables("Comment").Value = "ERROR NUMBER  : " & CStr(ErNUMBER.Value) & Chr(13) & Chr(10) _
                                               & "ERROR STATE   : " & CStr(ErSTATE.Value) & Chr(13) & Chr(10) _
                                               & "ERROR LINE    : " & CStr(ErLINE.Value) & Chr(13) & Chr(10) _
                                               & "ERROR MESSAGE : " & CStr(ErMESSAGE.Value) & Chr(13) & Chr(10)
                Dts.Variables("Err_Flag").Value = True
                Dts.TaskResult = Dts.Results.Failure
            End If
            MyCom.Dispose() '開放処理

        Catch ex As Exception
            Dts.Variables("Comment").Value = "Connectioninformation : " & Dts.Connections("ADO.Purchase").ConnectionString & Chr(13) & Chr(10) _
                                           & "Error Message : " & ex.Message & Chr(13) & Chr(10)
            Dts.Variables("Err_Flag").Value = True
            Dts.TaskResult = Dts.Results.Failure
        Finally

            DBConn.Close()
            DBConn.Dispose()
        End Try

    End Sub

End Class]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact"></DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:Property DTS:Name="ObjectName">終了メッセージ生成</DTS:Property><DTS:Property DTS:Name="DTSID">{01CB9142-0D89-4315-AE83-D141895537A9}</DTS:Property><DTS:Property DTS:Name="Description">終了メッセージ生成</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptTask, Microsoft.SqlServer.ScriptTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><ScriptProject Name="ScriptTask_ec3d93af191b459daecbf87693118396" Language="Microsoft Visual Basic .NET" EntryPoint="ScriptMain" SaveBinaries="False" ReadOnlyVariables="" ReadWriteVariables="Comment,Start_Time,End_Time,Dir_Log,Err_Flag"><ProjectItem Name="dts://Scripts/ScriptTask_ec3d93af191b459daecbf87693118396/ScriptMain.vsaitem">
<![CDATA[' Microsoft SQL Server Integration Services Script Task
' Write scripts using Microsoft Visual Basic
' The ScriptMain class is the entry point of the Script Task.

Imports System
Imports System.Data
Imports System.Math
Imports System.IO
Imports Microsoft.SqlServer.Dts.Runtime

Public Class ScriptMain

    Public Sub Main()

        Dim stb_log As New Text.StringBuilder
        Dim file_log As String = Dts.Variables("Dir_Log").Value.ToString & Format(Now(), "yyyyMMdd") & ".log"

        ' 処理結果コメント生成
        Dts.Variables("End_Time").Value = Now()
        stb_log.Append("[Purchase] 仕入先インポート" & vbCrLf)
        stb_log.Append("開始時刻: " & Dts.Variables("Start_Time").Value.ToString & vbCrLf)
        stb_log.Append("終了時刻: " & Dts.Variables("End_Time").Value.ToString & vbCrLf & vbCrLf)
        stb_log.Append(Dts.Variables("Comment").Value.ToString)

        ' ログ書き込み
        Using sw As StreamWriter = File.AppendText(file_log)
            sw.WriteLine(stb_log.ToString)
            sw.WriteLine("-------------------------------")
            sw.Flush()
            sw.Close()
        End Using

        ' エラーがあった場合はメール送信
        If CBool(Dts.Variables("Err_Flag").Value) Then
            Dts.Variables("Comment").Value = stb_log.ToString
            Exit Sub
        End If


        Dts.TaskResult = Dts.Results.Success
    End Sub

End Class]]></ProjectItem><ProjectItem Name="dts://Scripts/ScriptTask_ec3d93af191b459daecbf87693118396/ScriptTask_ec3d93af191b459daecbf87693118396.vsaproj">
<![CDATA[<VisualStudioProject>
    <VisualBasic
        Version = "8.0.50727.42"
        MVID = "{00000000-0000-0000-0000-000000000000}"
        ProjectType = "Local"
        ProductVersion = "8.0.50727"
        SchemaVersion = "2.0"
    >
        <Build>
            <Settings
                DefaultNamespace = "ScriptTask_ec3d93af191b459daecbf87693118396"
                OptionCompare = "0"
                OptionExplicit = "1"
                OptionStrict = "1"
                ProjectName = "ScriptTask_ec3d93af191b459daecbf87693118396"
                ReferencePath = "C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ScriptTask\9.0.242.0__89845dcd8080cc91\;C:\WINDOWS\assembly\GAC_MSIL\Microsoft.SqlServer.ManagedDTS\9.0.242.0__89845dcd8080cc91\"
                TreatWarningsAsErrors = "false"
                WarningLevel = "1"
                RootNamespace = "ScriptTask_ec3d93af191b459daecbf87693118396"
            >
                <Config
                    Name = "Debug"
                    DefineConstants = ""
                    DefineDebug = "true"
                    DefineTrace = "true"
                    DebugSymbols = "true"
                    RemoveIntegerChecks = "false"
                />
            </Settings>
            <References>
                <Reference
                    Name = "System"
                    AssemblyName = "System"
                />
                <Reference
                    Name = "System.Data"
                    AssemblyName = "System.Data"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ScriptTask"
                    AssemblyName = "Microsoft.SqlServer.ScriptTask"
                />
                <Reference
                    Name = "Microsoft.SqlServer.ManagedDTS"
                    AssemblyName = "Microsoft.SqlServer.ManagedDTS"
                />
            </References>
            <Imports>
                <Import Namespace = "Microsoft.VisualBasic" />
            </Imports>
        </Build>
        <Files>
            <Include>
                <File
                    RelPath = "ScriptMain"
                    BuildAction = "Compile"
                    ItemType = "2"
                />
                <VSAAppGlobal
                    VSAAppGlobalName = "Dts"
                    ItemType = "1"
                    VSAAppGlobalType = "Microsoft.SqlServer.Dts.Tasks.ScriptTask.ScriptObjectModel"
                />
            </Include>
        </Files>
        <Folders>
            <Include/>
        </Folders>
    </VisualBasic>
</VisualStudioProject>]]></ProjectItem></ScriptProject></DTS:ObjectData></DTS:Executable>
<DTS:Executable DTS:ExecutableType="Microsoft.SqlServer.Dts.Tasks.SendMailTask.SendMailTask, Microsoft.SqlServer.SendMailTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91" DTS:ThreadHint="0"><DTS:Property DTS:Name="ExecutionLocation">0</DTS:Property><DTS:Property DTS:Name="ExecutionAddress"></DTS:Property><DTS:Property DTS:Name="TaskContact">Send Mail Task; Microsoft Corporation; Microsoft SQL Server v9; © 2004 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1</DTS:Property><DTS:Property DTS:Name="ForceExecValue">0</DTS:Property><DTS:Property DTS:Name="ExecValue" DTS:DataType="3">0</DTS:Property><DTS:Property DTS:Name="ForceExecutionResult">-1</DTS:Property><DTS:Property DTS:Name="Disabled">0</DTS:Property><DTS:Property DTS:Name="FailPackageOnFailure">0</DTS:Property><DTS:Property DTS:Name="FailParentOnFailure">0</DTS:Property><DTS:Property DTS:Name="MaxErrorCount">1</DTS:Property><DTS:Property DTS:Name="ISOLevel">1048576</DTS:Property><DTS:Property DTS:Name="LocaleID">-1</DTS:Property><DTS:Property DTS:Name="TransactionOption">1</DTS:Property><DTS:Property DTS:Name="DelayValidation">0</DTS:Property>
<DTS:LoggingOptions><DTS:Property DTS:Name="LoggingMode">0</DTS:Property><DTS:Property DTS:Name="FilterKind">1</DTS:Property><DTS:Property DTS:Name="EventFilter" DTS:DataType="8"></DTS:Property></DTS:LoggingOptions><DTS:PropertyExpression DTS:Name="ToLine">@[User::Mail_To]</DTS:PropertyExpression><DTS:Property DTS:Name="ObjectName">メール送信タスク</DTS:Property><DTS:Property DTS:Name="DTSID">{2F30E273-A823-49CE-AB13-376E0394D36D}</DTS:Property><DTS:Property DTS:Name="Description">メール送信タスク</DTS:Property><DTS:Property DTS:Name="CreationName">Microsoft.SqlServer.Dts.Tasks.SendMailTask.SendMailTask, Microsoft.SqlServer.SendMailTask, Version=9.0.242.0, Culture=neutral, PublicKeyToken=89845dcd8080cc91</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property><DTS:ObjectData><SendMailTask:SendMailTaskData SendMailTask:SMTPServer="{E271125B-E698-49A8-B2B0-0B0D1949DB2C}" SendMailTask:From="app@tokyokasei.co.jp" SendMailTask:To="JOSYS-8@tokyokasei.co.jp" SendMailTask:CC="" SendMailTask:BCC="" SendMailTask:Subject="[Purchase] 仕入先インポートでエラーが発生しました" SendMailTask:Priority="High" SendMailTask:MessageSourceType="Variable" SendMailTask:MessageSource="User::Comment" xmlns:SendMailTask="www.microsoft.com/sqlserver/dts/tasks/sendmailtask"/></DTS:ObjectData></DTS:Executable>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">2</DTS:Property><DTS:Property DTS:Name="EvalOp">2</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression"></DTS:Property><DTS:Executable IDREF="{988D1188-F12A-4350-93B6-B62D3D3AFBAA}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{01CB9142-0D89-4315-AE83-D141895537A9}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約 1</DTS:Property><DTS:Property DTS:Name="DTSID">{6E54981B-18CE-44B4-9AB0-B8BB858B9029}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint>
<DTS:PrecedenceConstraint><DTS:Property DTS:Name="Value">1</DTS:Property><DTS:Property DTS:Name="EvalOp">1</DTS:Property><DTS:Property DTS:Name="LogicalAnd">-1</DTS:Property><DTS:Property DTS:Name="Expression">@[User::Err_Flag] == True</DTS:Property><DTS:Executable IDREF="{01CB9142-0D89-4315-AE83-D141895537A9}" DTS:IsFrom="-1"/><DTS:Executable IDREF="{2F30E273-A823-49CE-AB13-376E0394D36D}" DTS:IsFrom="0"/><DTS:Property DTS:Name="ObjectName">制約</DTS:Property><DTS:Property DTS:Name="DTSID">{81CFFE4B-CB0B-4CD3-B895-919BAB86580A}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName"></DTS:Property></DTS:PrecedenceConstraint><DTS:Property DTS:Name="ObjectName">Package</DTS:Property><DTS:Property DTS:Name="DTSID">{23F09C9A-DF24-49D4-8292-E077E4F563AA}</DTS:Property><DTS:Property DTS:Name="Description"></DTS:Property><DTS:Property DTS:Name="CreationName">MSDTS.Package.1</DTS:Property><DTS:Property DTS:Name="DisableEventHandlers">0</DTS:Property></DTS:Executable>